(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3843,5584],{2199:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(95155),r=s(12115),i=s(8794),o=s(35695),l=s(6874),n=s.n(l),c=s(92071),d=s(5279),u=s(57765),m=s(72227),h=s(14170),p=s(92975);function g(){let e=(0,o.useRouter)(),[t,l]=(0,r.useState)(!1);(0,r.useEffect)(()=>{"true"===new URL(window.location.href).searchParams.get("new")&&(l(!0),e.replace("/dashboard-visits"))},[e]);let{user:g}=(0,i.A)(),[x,v]=(0,r.useState)({}),[f,b]=(0,r.useState)([]),[w,y]=(0,r.useState)([]),[j,N]=(0,r.useState)([]),[k,E]=(0,r.useState)([]),[C,I]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),[P,D]=(0,r.useState)(!1),[L,V]=(0,r.useState)("all"),[T,O]=(0,r.useState)(""),[F,M]=(0,r.useState)("all"),[R,_]=(0,r.useState)({patientId:"",patientName:"",templateId:"",templateName:"",date:new Date().toISOString().slice(0,16),status:"scheduled",provider:"",notes:""});(0,r.useEffect)(()=>{t&&D(!0)},[t]),(0,r.useEffect)(()=>{(async()=>{if(console.log("Setting up authentication..."),!g){console.log("No user available, cannot set up auth header");return}console.log("User available:",{uid:g.uid,email:g.email,isAnonymous:g.isAnonymous});try{let{auth:e}=await Promise.resolve().then(s.bind(s,13843)),t=e.currentUser;if(t){console.log("Firebase currentUser matches:",t.uid===g.uid);let e=await t.getIdToken();console.log("Token obtained, first 10 chars:",e.substring(0,10)+"..."),v({Authorization:"Bearer ".concat(e)}),console.log("Auth header set, will load visits when state updates")}else console.error("Firebase currentUser is null despite having user context")}catch(e){console.error("Error setting up auth:",e),A("Authentication error. Please reload the page.")}})()},[g]),(0,r.useEffect)(()=>{Object.keys(x).length>0&&(console.log("Auth header state updated, now loading visits"),B())},[x]);let U=e=>{let t={...e};if(e.status){let s=e.status.toLowerCase();t.status=({scheduled:"scheduled","in-progress":"in-progress","in progress":"in-progress",inprogress:"in-progress",in_progress:"in-progress",complete:"completed",completed:"completed",cancelled:"cancelled",canceled:"cancelled"})[s]||s}return t},B=async()=>{if(0===Object.keys(x).length){console.error("Error: loadVisits called but authHeader is empty");return}I(!0),A(null);try{console.log("Loading visits with auth header:",{headerExists:!!x,headerLength:Object.keys(x).length,userId:null==g?void 0:g.uid});let e=await fetch("/api/visits",{headers:{...x}});if(console.log("Visits API response status:",e.status,e.statusText),!e.ok)throw Error("Error: ".concat(e.status," ").concat(e.statusText));let t=await e.json();console.log("Visits loaded:",t,"Total visits:",t.length);let s=t.map(e=>U({...e,date:new Date(e.date)}));b(s),q(s,L,T)}catch(e){console.error("Error loading visits:",e),A("Failed to load visits: ".concat(e.message))}finally{I(!1)}};(0,r.useEffect)(()=>{P&&Object.keys(x).length>0&&H()},[P,x]);let H=async()=>{if(0!==Object.keys(x).length)try{let e=await fetch("/api/patients",{headers:{...x}});if(e.ok){let t=await e.json();N(t)}let t=await fetch("/api/templates",{headers:{...x}});if(t.ok){let e=await t.json();E(e)}}catch(e){console.error("Error loading reference data:",e)}};(0,r.useEffect)(()=>{q(f,"all"!==F?F:L,T)},[L,T,F,f]);let q=(e,t,s)=>{let a=[...e];if("all"!==t&&(a=a.filter(e=>U(e).status===t)),s.trim()){let e=s.toLowerCase();a=a.filter(t=>{var s,a,r;return(null===(s=t.patientName)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(a=t.templateName)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(r=t.provider)||void 0===r?void 0:r.toLowerCase().includes(e))})}a.sort((e,t)=>{let s=new Date(e.date);return new Date(t.date).getTime()-s.getTime()}),y(a)},Z=f.filter(e=>"scheduled"===U(e).status),W=f.filter(e=>"in-progress"===U(e).status),J=f.filter(e=>"completed"===U(e).status);(0,r.useEffect)(()=>{f.length>0&&(console.log("VISITS STATUS DEBUG:"),console.log("Total visits:",f.length),console.log("Unique status values:",[...new Set(f.map(e=>e.status))]),console.log("Visits by status:"),console.log("- Scheduled:",Z.length),console.log("- In Progress:",W.length),console.log("- Completed:",J.length),console.log("Sample visits:"),f.slice(0,3).forEach((e,t)=>{console.log("Visit ".concat(t+1,":"),{id:e.id||e._id,patientName:e.patientName,status:e.status,statusType:typeof e.status})}))},[f]);let z=e=>{let{name:t,value:s}=e.target;if("patientId"===t&&s){let e=j.find(e=>e.id===s||e._id===s);_({...R,patientId:s,patientName:(null==e?void 0:e.name)||""})}else if("templateId"===t&&s){let e=k.find(e=>e.id===s||e._id===s);_({...R,templateId:s,templateName:(null==e?void 0:e.name)||""})}else _({...R,[t]:s})},Q=async e=>{if(e.preventDefault(),console.log("Form submitted - handleCreateVisit called"),!g){console.error("Error: No user logged in"),A("You must be logged in to create a visit.");return}if(console.log("User creating visit:",{uid:g.uid,uidType:typeof g.uid,email:g.email}),0===Object.keys(x).length){console.error("Error: No auth header available"),A("Not authenticated. Please reload the page.");return}if(!R.patientId||!R.templateId||!R.date||!R.provider){console.error("Error: Missing required fields",{patientId:!!R.patientId,templateId:!!R.templateId,date:!!R.date,provider:!!R.provider}),A("Please fill out all required fields");return}console.log("Form validation passed, attempting to create visit"),I(!0),A(null);try{let e;if(!R.templateName&&R.templateId){let e=k.find(e=>e.id===R.templateId||e._id===R.templateId);e&&(R.templateName=e.name)}try{if(e=new Date(R.date),isNaN(e.getTime()))throw Error("Invalid date format");console.log("Date parsed successfully:",e.toISOString())}catch(e){console.error("Error parsing date:",R.date,e),A("Please enter a valid date and time"),I(!1);return}let t={patientId:R.patientId,patientName:R.patientName,templateId:R.templateId,templateName:R.templateName||"Unknown Template",date:e.toISOString(),status:R.status.toLowerCase(),provider:R.provider,notes:R.notes,userId:g.uid};console.log("Creating visit with data:",JSON.stringify(t,null,2)),console.log("Sending request to /api/visits");let s=await fetch("/api/visits",{method:"POST",headers:{"Content-Type":"application/json",...x},body:JSON.stringify(t)});if(console.log("Response received. Status:",s.status),!s.ok){let e=await s.text();console.error("Error response:",e);try{e=JSON.parse(e).error||e}catch(e){}throw Error("Failed to create visit: ".concat(s.status," ").concat(e))}let a=await s.json();console.log("Visit created successfully:",a),_({patientId:"",patientName:"",templateId:"",templateName:"",date:new Date().toISOString().slice(0,16),status:"scheduled",provider:"",notes:""}),D(!1),await B()}catch(e){console.error("Error creating visit:",e),A("Failed to create visit: ".concat(e.message))}finally{I(!1)}},Y=async(e,t)=>{if(0===Object.keys(x).length){A("Not authenticated. Please reload the page.");return}I(!0),A(null);try{let s=await fetch("/api/visits/".concat(e),{headers:{...x}});if(!s.ok)throw Error("Error fetching visit: ".concat(s.status));let a={...await s.json(),status:t.toLowerCase()},r=await fetch("/api/visits/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...x},body:JSON.stringify(a)});if(!r.ok){let e=await r.text();throw Error("Update failed: ".concat(e))}console.log("Visit updated successfully"),await B()}catch(e){console.error("Error updating visit:",e),A("Failed to update visit: ".concat(e.message))}finally{I(!1)}},G=async e=>{if(confirm("Are you sure you want to delete this visit?")){if(0===Object.keys(x).length){A("Not authenticated. Please reload the page.");return}I(!0),A(null);try{let t=await fetch("/api/visits/".concat(e),{method:"DELETE",headers:{...x}});if(!t.ok){let e=await t.text();throw Error("Delete failed: ".concat(e))}console.log("Visit deleted successfully"),await B()}catch(e){console.error("Error deleting visit:",e),A("Failed to delete visit: ".concat(e.message))}finally{I(!1)}}},K=e=>(e instanceof Date?e:new Date(e)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=async t=>{if(!t){console.error("Error: No visit ID provided"),A("Cannot start visit: Missing visit ID");return}console.log("Starting visit ".concat(t,"...")),I(!0);try{await Y(t,"in-progress"),console.log("Visit ".concat(t," status updated to in-progress")),console.log("Navigating to conduct page for visit ".concat(t)),setTimeout(()=>{e.push("/visits/".concat(t,"/conduct"))},500)}catch(e){console.error("Error starting visit:",e),A("Failed to start visit: ".concat(e)),I(!1)}},$=async t=>{if(!t){console.error("Error: No visit ID provided"),A("Cannot continue visit: Missing visit ID");return}console.log("Continuing visit ".concat(t,"...")),I(!0);try{console.log("Navigating to conduct page for visit ".concat(t)),e.push("/visits/".concat(t,"/conduct"))}catch(e){console.error("Error continuing visit:",e),A("Failed to continue visit: ".concat(e)),I(!1)}},ee=async e=>{if(!e){console.error("Error: No visit ID provided"),A("Cannot complete visit: Missing visit ID");return}if(confirm("Are you sure you want to mark this visit as completed?")){console.log("Completing visit ".concat(e,"...")),I(!0);try{await Y(e,"completed"),console.log("Visit ".concat(e," marked as completed")),A(null),await B()}catch(e){console.error("Error completing visit:",e),A("Failed to complete visit: ".concat(e))}finally{I(!1)}}},et=async()=>{I(!0),A(null);try{console.log("Testing API connection - fetching visits");let e=await fetch("/api/visits",{headers:{...x}});if(console.log("API Test response status:",e.status),!e.ok)throw Error("API test failed: ".concat(e.status," ").concat(e.statusText));let t=await e.json();console.log("API test successful, received data:",t),A("API connection test successful! Received data from server.")}catch(e){console.error("API test error:",e),A("API connection test failed: ".concat(e.message))}finally{I(!1)}},es=async()=>{I(!0),A(null);try{console.log("Checking database contents directly");let e=await fetch("/api/debug");if(!e.ok)throw Error("Debug request failed: ".concat(e.status," ").concat(e.statusText));let t=await e.json();console.log("Debug info received:",t),A("Database contains ".concat(t.totalVisits," total visits for ").concat(t.uniqueUserIds," users. Sample IDs: ").concat(t.sampleUserIds.join(", ")))}catch(e){console.error("Debug request error:",e),A("Debug request failed: ".concat(e.message))}finally{I(!1)}},ea=async()=>{if(0===Object.keys(x).length){A("Not authenticated. Please reload the page.");return}I(!0),A(null);try{console.log("Fixing status values in database");let e=await fetch("/api/debug/fix-status",{headers:{...x}});if(!e.ok)throw Error("Fix status request failed: ".concat(e.status," ").concat(e.statusText));let t=await e.json();console.log("Fix status response:",t),t.success?(A("Successfully fixed ".concat(t.message,". Reloading visits...")),B()):A("Fix status operation failed: ".concat(t.error||"Unknown error"))}catch(e){console.error("Fix status error:",e),A("Fix status request failed: ".concat(e.message))}finally{I(!1)}},er=async t=>{if(!t){console.error("Error: No visit ID provided"),A("Cannot edit visit: Missing visit ID");return}console.log("Editing visit ".concat(t,"...")),I(!0);try{console.log("Navigating to conduct page for editing visit ".concat(t)),e.push("/visits/".concat(t,"/conduct?allowEdit=true"))}catch(e){console.error("Error editing visit:",e),A("Failed to edit visit: ".concat(e.message))}finally{I(!1)}},ei=async t=>{if(!t){console.error("Error: No visit ID provided"),A("Cannot view plan: Missing visit ID");return}console.log("Viewing plan for visit ".concat(t,"...")),I(!0);try{console.log("Navigating to conduct page with showPlan=true for visit ".concat(t)),e.push("/visits/".concat(t,"/conduct?showPlan=true"))}catch(e){console.error("Error navigating to plan view: ".concat(e)),A("Failed to view plan: ".concat(e.message))}finally{I(!1)}},eo=async e=>{if(!e){console.error("Error: No visit ID provided"),A("Cannot save as PDF: Missing visit ID");return}console.log("Saving visit ".concat(e," as PDF...")),I(!0),A(null);try{let t=await fetch("/api/visits/".concat(e,"?includeTemplate=true&includeQuestionDetails=true"),{headers:{...x}});if(!t.ok)throw Error("Error fetching visit: ".concat(t.status));let s=await t.json();console.log("Visit data fetched:",s);let a={...s};if(s.templateId&&!s.template)try{console.log("Fetching template data for template ID: ".concat(s.templateId));let e=await fetch("/api/templates/".concat(s.templateId,"?includeQuestionDetails=true"),{headers:{...x}});if(e.ok){let t=await e.json();a.template=t,console.log("Template data fetched:",t)}else console.warn("Unable to fetch template: ".concat(e.status))}catch(e){console.error("Error fetching template data:",e)}if(a.template&&!a.template.questions)try{console.log("Template missing questions array, fetching complete template data");let e=await fetch("/api/templates/".concat(s.templateId,"?includeQuestions=true"),{headers:{...x}});if(e.ok){let t=await e.json();a.template=t,console.log("Complete template data fetched:",t)}}catch(e){console.error("Error fetching complete template data:",e)}console.log("Generating PDF with visit data only (no health plan)...");let r=await fetch("/api/visits/pdf",{method:"POST",headers:{"Content-Type":"application/json",...x},body:JSON.stringify({visitId:e,visitData:a,excludeHealthPlan:!0})});if(!r.ok){let e=await r.text();throw console.error("PDF generation failed:",e),Error("Error generating PDF: ".concat(r.status,". ").concat(e))}let i=await r.blob(),o=URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download="Visit_Assessment_".concat(e,".pdf"),l.click(),URL.revokeObjectURL(o),console.log("Visit saved as PDF successfully"),I(!1)}catch(e){console.error("Error saving as PDF:",e),A("Failed to save as PDF: ".concat(e.message)),I(!1)}};return(0,a.jsxs)("div",{className:"p-6 max-w-6xl mx-auto",children:[(0,a.jsx)(c.A,{title:"Visit Management",breadcrumbs:[{name:"Visits",href:"/dashboard-visits",current:!0}]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Manage and conduct patient visits"})}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>B(),className:"flex items-center px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded text-sm",disabled:C,children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Refresh"]}),(0,a.jsxs)("button",{onClick:()=>D(!P),className:"flex items-center px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm",children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"New Visit"]})]})]}),S&&(0,a.jsxs)("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-6",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Error:"}),(0,a.jsx)("p",{children:S})]}),C&&(0,a.jsx)("div",{className:"animate-pulse text-center p-4 mb-6 bg-blue-50 rounded",children:"Loading..."}),P&&(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)("div",{className:"bg-blue-100 p-2 rounded-full mr-3",children:(0,a.jsx)(m.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Create New Visit"})]}),(0,a.jsxs)("form",{onSubmit:Q,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Patient *"}),(0,a.jsxs)("select",{name:"patientId",value:R.patientId,onChange:z,className:"w-full p-2 border rounded",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Patient"}),j.map(e=>(0,a.jsx)("option",{value:e.id||e._id,children:e.name},e.id||e._id))]}),0===j.length&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["No patients available. ",(0,a.jsx)(n(),{href:"/patients",className:"text-blue-500 hover:underline",children:"Create a patient"})," first."]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Template *"}),(0,a.jsxs)("select",{name:"templateId",value:R.templateId,onChange:z,className:"w-full p-2 border rounded",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Select Template"}),k.map(e=>(0,a.jsx)("option",{value:e.id||e._id,children:e.name},e.id||e._id))]}),0===k.length&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["No templates available. ",(0,a.jsx)(n(),{href:"/templates",className:"text-blue-500 hover:underline",children:"Create a template"})," first."]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Date & Time *"}),(0,a.jsx)("input",{type:"datetime-local",name:"date",value:R.date,onChange:z,className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Status"}),(0,a.jsxs)("select",{name:"status",value:R.status,onChange:z,className:"w-full p-2 border rounded",children:[(0,a.jsx)("option",{value:"scheduled",children:"Scheduled"}),(0,a.jsx)("option",{value:"in-progress",children:"In Progress"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Provider *"}),(0,a.jsx)("input",{type:"text",name:"provider",value:R.provider,onChange:z,className:"w-full p-2 border rounded",placeholder:"Provider name",required:!0})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),(0,a.jsx)("textarea",{name:"notes",value:R.notes,onChange:z,className:"w-full p-2 border rounded",rows:3,placeholder:"Optional notes about this visit"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:ea,className:"px-4 py-2 border border-gray-300 rounded shadow-sm text-sm font-medium text-gray-700 bg-yellow-100 hover:bg-yellow-200",children:"Fix Status Values"}),(0,a.jsx)("button",{type:"button",onClick:es,className:"px-4 py-2 border border-gray-300 rounded shadow-sm text-sm font-medium text-gray-700 bg-red-100 hover:bg-red-200",children:"Debug Database"}),(0,a.jsx)("button",{type:"button",onClick:et,className:"px-4 py-2 border border-gray-300 rounded shadow-sm text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200",children:"Test API Connection"}),(0,a.jsx)("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 rounded shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",disabled:C,children:C?"Creating...":"Create Visit"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg mb-6 overflow-hidden",children:[(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsxs)("nav",{className:"-mb-px flex",children:[(0,a.jsxs)("button",{onClick:()=>M("all"),className:"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ".concat("all"===F?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["All Visits (",f.length,")"]}),(0,a.jsxs)("button",{onClick:()=>M("scheduled"),className:"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ".concat("scheduled"===F?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Scheduled (",Z.length,")"]}),(0,a.jsxs)("button",{onClick:()=>M("in-progress"),className:"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ".concat("in-progress"===F?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["In Progress (",W.length,")"]}),(0,a.jsxs)("button",{onClick:()=>M("completed"),className:"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ".concat("completed"===F?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Completed (",J.length,")"]})]})}),(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:(0,a.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:(0,a.jsxs)("div",{className:"relative rounded-md w-full md:w-64",children:[(0,a.jsx)("input",{type:"text",className:"w-full px-4 py-2 border rounded-md pl-10",placeholder:"Search visits...",value:T,onChange:e=>O(e.target.value)}),(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]})})}),w.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Patient"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Template"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Provider"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("scheduled"===e.status?"bg-blue-100 text-blue-800":"in-progress"===e.status?"bg-yellow-100 text-yellow-800":"completed"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-8 w-8 bg-gray-200 rounded-full flex items-center justify-center",children:(0,a.jsx)(h.A,{className:"h-4 w-4 text-gray-500"})}),(0,a.jsx)("div",{className:"ml-4",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.patientName})})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-gray-400 mr-2"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.templateName})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:K(e.date)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.provider||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:["scheduled"===e.status&&(0,a.jsx)("button",{onClick:()=>X(e.id||e._id||""),className:"text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded",children:"Start"}),"in-progress"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>$(e.id||e._id||""),className:"text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded",children:"Continue"}),(0,a.jsx)("button",{onClick:()=>ee(e.id||e._id||""),className:"text-yellow-600 hover:text-yellow-900 bg-yellow-50 hover:bg-yellow-100 px-2 py-1 rounded",children:"Complete"})]}),"completed"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>er(e.id||e._id||""),className:"text-green-600 hover:text-green-900 bg-green-50 hover:bg-green-100 px-2 py-1 rounded",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>ei(e.id||e._id||""),className:"text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-2 py-1 rounded",children:"View Plan"}),(0,a.jsx)("button",{onClick:()=>eo(e.id||e._id||""),className:"text-purple-600 hover:text-purple-900 bg-purple-50 hover:bg-purple-100 px-2 py-1 rounded",children:"Save PDF"})]}),(0,a.jsx)("button",{onClick:()=>G(e.id||e._id||""),className:"text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 px-2 py-1 rounded",children:"Delete"})]})})]},e.id||e._id))})]})}):(0,a.jsxs)("div",{className:"text-center py-12 bg-white",children:[(0,a.jsx)(m.A,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No visits"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:0===f.length?"You haven't created any visits yet.":"No visits match your current filters."}),0===f.length&&(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)("button",{type:"button",onClick:()=>D(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(u.A,{className:"-ml-1 mr-2 h-5 w-5","aria-hidden":"true"}),"New Visit"]})})]})]})]})}},5279:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))})},8794:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,AuthProvider:()=>c});var a=s(95155),r=s(12115),i=s(93004),o=s(35317),l=s(13843);let n=(0,r.createContext)({user:null,login:async()=>{throw Error("Not implemented")},signup:async()=>{throw Error("Not implemented")},logout:async()=>{throw Error("Not implemented")},loading:!0});function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,i.hg)(l.auth,e=>{c(e),u(!1)});return()=>e()},[]);let m=async(e,t)=>{try{let s=await (0,i.x9)(l.auth,e,t);return c(s.user),localStorage.setItem("last-login-email",e),s.user}catch(e){throw console.error("Login error:",e.code,e.message),e}},h=async(e,t,s)=>{try{let a=(await (0,i.eJ)(l.auth,t,s)).user;return await (0,i.r7)(a,{displayName:e}),await (0,o.BN)((0,o.H9)(l.db,"users",a.uid),{uid:a.uid,displayName:e,email:t,createdAt:new Date().toISOString()}),c(a),a}catch(e){throw console.error("Signup error:",e.code,e.message),e}},p=async()=>{try{await (0,i.CI)(l.auth),c(null)}catch(e){throw console.error("Logout error:",e.code,e.message),e}};return(0,a.jsx)(n.Provider,{value:{user:s,login:m,signup:h,logout:p,loading:d},children:t})}let d=()=>(0,r.useContext)(n)},13843:(e,t,s)=>{"use strict";let a;s.d(t,{auth:()=>l,db:()=>n});var r=s(23915),i=s(93004),o=s(35317);a=(0,r.Dk)().length?(0,r.Dk)()[0]:(0,r.Wp)({apiKey:"AIzaSyCUXDjtCkalFKkukgedZePOySwYLimkakM",authDomain:"new-awv-app.firebaseapp.com",projectId:"new-awv-app",storageBucket:"new-awv-app.firebasestorage.app",messagingSenderId:"466832878",appId:"1:466832878:web:504bb7a0b7de0705cad2ff"});let l=(0,i.xI)(a),n=(0,o.aU)(a)},14170:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))})},35695:(e,t,s)=>{"use strict";var a=s(18999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},40058:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))})},49378:(e,t,s)=>{Promise.resolve().then(s.bind(s,2199))},57765:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))})},64219:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))})},69994:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))})},72227:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))})},92071:(e,t,s)=>{"use strict";s.d(t,{A:()=>p});var a=s(95155),r=s(12115),i=s(6874),o=s.n(i),l=s(35695),n=s(69994),c=s(40058),d=s(72227),u=s(64219),m=s(94830);let h=r.forwardRef(function(e,t){let{title:s,titleId:a,...i}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))});function p(e){let{title:t,breadcrumbs:s}=e,r=(0,l.usePathname)(),i="/dashboard"!==r,p=!r.includes("/patients/new");r.includes("/templates/new");let g=!r.includes("/visits/schedule")&&!r.includes("/dashboard-visits"),x=!r.includes("/patients")||r.includes("/patients/new"),v=!r.includes("/visits")&&!r.includes("/dashboard-visits")||r.includes("/visits/schedule"),f=!r.includes("/templates")||r.includes("/templates/new");return(0,a.jsxs)("div",{className:"mb-8",children:[(t||s)&&(0,a.jsxs)("div",{className:"mb-4",children:[t&&(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:t}),s&&s.length>0&&(0,a.jsx)("nav",{className:"flex mt-1","aria-label":"Breadcrumb",children:(0,a.jsx)("ol",{className:"flex items-center space-x-2",children:s.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"flex items-center",children:[t>0&&(0,a.jsx)("svg",{className:"h-5 w-5 flex-shrink-0 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M5.555 17.776l8-16 .894.448-8 16-.894-.448z"})}),(0,a.jsx)(o(),{href:e.href,className:"ml-2 text-sm font-medium ".concat(e.current?"text-gray-700":"text-gray-500 hover:text-gray-700"),"aria-current":e.current?"page":void 0,children:e.name})]})},e.href))})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[i&&(0,a.jsxs)(o(),{href:"/dashboard",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(n.A,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Dashboard"]}),p&&(0,a.jsxs)(o(),{href:"/patients/new",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(c.A,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Add Patient"]}),g&&(0,a.jsxs)(o(),{href:"/dashboard-visits?new=true",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(d.A,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Schedule Visit"]}),x&&(0,a.jsxs)(o(),{href:"/patients",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(u.A,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Patients"]}),v&&(0,a.jsxs)(o(),{href:"/dashboard-visits",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(m.A,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Visits"]}),f&&(0,a.jsxs)(o(),{href:"/templates",className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[(0,a.jsx)(h,{className:"-ml-1 mr-2 h-5 w-5 text-gray-500"}),"Templates"]})]})]})}},92975:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))})},94830:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...i}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},i),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9192,6874,7131,9224,8441,1684,7358],()=>t(49378)),_N_E=e.O()}]);