(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3843,7164],{6865:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))})},8794:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,AuthProvider:()=>c});var a=s(95155),r=s(12115),n=s(93004),o=s(35317),i=s(13843);let l=(0,r.createContext)({user:null,login:async()=>{throw Error("Not implemented")},signup:async()=>{throw Error("Not implemented")},logout:async()=>{throw Error("Not implemented")},loading:!0});function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=(0,n.hg)(i.auth,e=>{c(e),m(!1)});return()=>e()},[]);let u=async(e,t)=>{try{let s=await (0,n.x9)(i.auth,e,t);return c(s.user),localStorage.setItem("last-login-email",e),s.user}catch(e){throw console.error("Login error:",e.code,e.message),e}},h=async(e,t,s)=>{try{let a=(await (0,n.eJ)(i.auth,t,s)).user;return await (0,n.r7)(a,{displayName:e}),await (0,o.BN)((0,o.H9)(i.db,"users",a.uid),{uid:a.uid,displayName:e,email:t,createdAt:new Date().toISOString()}),c(a),a}catch(e){throw console.error("Signup error:",e.code,e.message),e}},x=async()=>{try{await (0,n.CI)(i.auth),c(null)}catch(e){throw console.error("Logout error:",e.code,e.message),e}};return(0,a.jsx)(l.Provider,{value:{user:s,login:u,signup:h,logout:x,loading:d},children:t})}let d=()=>(0,r.useContext)(l)},13843:(e,t,s)=>{"use strict";let a;s.d(t,{auth:()=>i,db:()=>l});var r=s(23915),n=s(93004),o=s(35317);a=(0,r.Dk)().length?(0,r.Dk)()[0]:(0,r.Wp)({apiKey:"AIzaSyCUXDjtCkalFKkukgedZePOySwYLimkakM",authDomain:"new-awv-app.firebaseapp.com",projectId:"new-awv-app",storageBucket:"new-awv-app.firebasestorage.app",messagingSenderId:"466832878",appId:"1:466832878:web:504bb7a0b7de0705cad2ff"});let i=(0,n.xI)(a),l=(0,o.aU)(a)},17896:(e,t,s)=>{Promise.resolve().then(s.bind(s,97904))},29337:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))})},32461:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))})},35695:(e,t,s)=>{"use strict";var a=s(18999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},47359:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))})},55628:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))})},74500:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))})},86469:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(12115);let r=a.forwardRef(function(e,t){let{title:s,titleId:r,...n}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},n),s?a.createElement("title",{id:r},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0 0 21 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 0 0-1.913-.247M6.34 18H5.25A2.25 2.25 0 0 1 3 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 0 1 1.913-.247m10.5 0a48.536 48.536 0 0 0-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5Zm-3 0h.008v.008H15V10.5Z"}))})},97904:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var a=s(95155),r=s(12115),n=s(35695),o=s(6874),i=s.n(o),l=s(55628),c=s(32461),d=s(6865);let m=r.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"}))}),u=r.forwardRef(function(e,t){let{title:s,titleId:a,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},n),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))});var h=s(86469),x=s(47359),g=s(29337),b=s(74500),p=s(8794);function f(e){let{params:t}=e,o=(0,n.useRouter)(),{user:f}=(0,p.A)(),v=t.id,[y,w]=(0,r.useState)(null),[j,N]=(0,r.useState)(null),[k,E]=(0,r.useState)(!0),[S,P]=(0,r.useState)(null),[q,C]=(0,r.useState)(0),[A,L]=(0,r.useState)({}),[I,O]=(0,r.useState)(!1),[R,M]=(0,r.useState)({}),[D,F]=(0,r.useState)(!1),[T,H]=(0,r.useState)(!1),[_,B]=(0,r.useState)(null),[U,V]=(0,r.useState)(!1),W=(null==j?void 0:j.sections)||[],z=W[q]||{questions:[]},Z=W.length>0?Math.round((q+1)/W.length*100):0,[J,G]=(0,r.useState)([]),[Q,Y]=(0,r.useState)(!1),[K,X]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(f){E(!0),P(null);try{let e={},{auth:t}=await Promise.resolve().then(s.bind(s,13843)),a=t.currentUser;if(a){let t=await a.getIdToken();e={Authorization:"Bearer ".concat(t)}}let r=await fetch("/api/visits/".concat(v),{headers:{...e}});if(!r.ok)throw Error("Error fetching visit: ".concat(r.statusText));let n=await r.json();if(w(n),n.responses&&L(n.responses),n.templateId){let t=await fetch("/api/templates/".concat(n.templateId),{headers:{...e}});if(t.ok){let e=await t.json();console.log("Template data loaded:",e),N(e)}else P("Unable to load the assessment template")}else P("This visit is not associated with a template")}catch(e){console.error("Error loading visit data:",e),P("Failed to load visit data. Please try again.")}finally{E(!1),F(!0)}}})()},[v,f]),(0,r.useEffect)(()=>{if(D&&y){let e=new URLSearchParams(window.location.search),t=e.get("showPlan"),s=e.get("allowEdit");"completed"!==y.status||("true"===s?console.log("allowEdit parameter detected, allowing editing of completed visit"):"true"!==t||Q||(console.log("showPlan parameter detected, generating plan..."),ec()))}},[D,y,Q]),(0,r.useEffect)(()=>{j&&y&&V(!0)},[j,y,A]),(0,r.useEffect)(()=>{j&&j.sections&&j.sections.length>0&&(console.log("Evaluating section skip logic for section",q),ea(q)&&(console.log("Section",q,"should be skipped, moving to next section"),er()))},[q,A,j]),(0,r.useEffect)(()=>{j&&j.sections&&j.sections.forEach((e,t)=>{ea(t)&&console.log("Section ".concat(t," (").concat(e.title,") would be skipped based on current responses"))})},[A,j]);let $=(e,t)=>{console.log("Response changed for question ".concat(e,":"),t),L(s=>({...s,[e]:t})),R[e]&&M(t=>{let s={...t};return delete s[e],s}),console.log("Re-evaluating skip logic after response change")},ee=()=>{if(!j||!j.sections||!j.sections[q])return!0;let e=j.sections[q].questions.filter(e=>e.required),t={};return e.forEach(e=>{let s=A[e.id];null==s||""===s?t[e.id]="This question requires an answer":Array.isArray(s)&&0===s.length&&(t[e.id]="Please select at least one option")}),M(t),0===Object.keys(t).length},et=(e,t)=>{let s=R[e.id];return es(e)?null:(0,a.jsxs)("div",{className:"mb-8 p-4 rounded-lg ".concat(s?"bg-red-50":"bg-white"),children:[(0,a.jsxs)("div",{className:"flex items-start mb-2",children:[(0,a.jsx)("span",{className:"flex items-center justify-center h-6 w-6 rounded-full bg-blue-100 text-blue-800 font-medium text-sm mr-2",children:t+1}),(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:[e.text,e.required&&(0,a.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]})]}),s&&(0,a.jsxs)("div",{className:"mt-1 mb-3 text-sm text-red-600 flex items-center",children:[(0,a.jsx)(l.A,{className:"h-4 w-4 mr-1"}),R[e.id]]}),(0,a.jsx)("div",{className:"mt-3",children:eo(e)})]},e.id)},es=e=>{if(!e.skipLogicRules||0===e.skipLogicRules.length)return!1;for(let t of e.skipLogicRules){if("SECTION"===t.targetType)continue;let{condition:s}=t,a=s.questionId,r=A[a];if(void 0===r)continue;let n=!1;switch(s.operator){case"equals":n=r===s.value;break;case"not_equals":n=r!==s.value;break;case"contains":n=Array.isArray(r)&&r.includes(s.value);break;case"not_contains":n=!Array.isArray(r)||!r.includes(s.value);break;case"greater_than":n=Number(r)>Number(s.value);break;case"less_than":n=Number(r)<Number(s.value);break;default:n=!1}if(console.log("Evaluating question skip logic rule:",{questionId:e.id,questionText:e.text,ruleId:t.id,sourceQuestionId:a,sourceResponse:r,operator:s.operator,value:s.value,conditionMet:n,action:t.action}),n){if("HIDE"===t.action)return console.log('Question "'.concat(e.text,'" will be hidden due to rule ').concat(t.id)),!0;if("SHOW"===t.action){console.log('Question "'.concat(e.text,'" will be shown due to rule ').concat(t.id));break}}}return!1},ea=e=>{if(!j||!j.sections||!j.sections[e])return!1;let t=j.sections[e];for(let s of t.questions||[])if(s.skipLogicRules)for(let a of s.skipLogicRules){if("SECTION"!==a.targetType)continue;let{condition:r}=a,n=r.questionId,o=A[n];if(void 0===o)continue;let i=!1;switch(r.operator){case"equals":i=o===r.value;break;case"not_equals":i=o!==r.value;break;case"contains":i=Array.isArray(o)&&o.includes(r.value);break;case"not_contains":i=!Array.isArray(o)||!o.includes(r.value);break;case"greater_than":i=Number(o)>Number(r.value);break;case"less_than":i=Number(o)<Number(r.value);break;default:i=!1}if(console.log("Evaluating section skip logic rule:",{sectionId:t.id,sectionTitle:t.title,questionId:s.id,ruleId:a.id,sourceQuestionId:n,sourceResponse:o,operator:r.operator,value:r.value,conditionMet:i,action:a.action,targetType:a.targetType,targetSectionId:a.targetSectionId}),i){if(a.targetSectionId===t.id&&"HIDE"===a.action)return console.log("Section ".concat(e," (").concat(t.title,") will be hidden due to rule ").concat(a.id)),!0;if(a.targetSectionId===t.id&&"SHOW"===a.action)return console.log("Section ".concat(e," (").concat(t.title,") will be shown due to rule ").concat(a.id)),!1}}return!1},er=()=>{if(ee()&&j&&j.sections&&q<j.sections.length-1){let e=q+1;for(;e<j.sections.length&&ea(e);)e++;e<j.sections.length?(C(e),window.scrollTo(0,0)):C(j.sections.length-1)}},en=async e=>{if(!y||!v){P("Cannot save visit: missing visit data or ID");return}if("completed"!==e||ee()){O(!0),P(null);try{var t,a;let r={},{auth:n}=await Promise.resolve().then(s.bind(s,13843)),i=n.currentUser;if(i){let e=await i.getIdToken();r={Authorization:"Bearer ".concat(e)}}let l=new URLSearchParams(window.location.search).get("allowEdit"),c="completed"===y.status&&"true"===l&&"in-progress"===e?"completed":e;console.log("Saving visit with status: ".concat(c," (original request: ").concat(e,")")),console.log("Visit object before update:",y);let d={...y,status:c.toLowerCase(),responses:{...A},lastUpdated:new Date().toISOString()};delete d._id,console.log("Sending updated visit data:",JSON.stringify(d,null,2));let m=await fetch("/api/visits/".concat(v),{method:"PUT",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(d)});if(!m.ok){let e=await m.text();console.error("Error response:",e);try{let t=JSON.parse(e);throw Error("Error updating visit: ".concat(t.error||m.statusText))}catch(e){throw Error("Error updating visit: ".concat(m.statusText||"Unknown error"))}}let u=await m.json();if(console.log("Visit successfully updated:",u),(null===(t=u.status)||void 0===t?void 0:t.toLowerCase())!==c.toLowerCase()&&console.warn("Warning: Expected status ".concat(c.toLowerCase()," but got ").concat(null===(a=u.status)||void 0===a?void 0:a.toLowerCase())),"completed"===c){console.log("Visit completed, redirecting to visits page..."),alert("Visit has been marked as completed!");try{await new Promise(e=>setTimeout(e,1e3)),window.location.href="/dashboard-visits"}catch(e){console.error("Navigation error:",e),o.push("/dashboard-visits")}}else alert("Progress saved successfully!")}catch(e){console.error("Error saving visit:",e),P(e.message||"Failed to save visit. Please try again.")}finally{O(!1)}}},eo=e=>{var t,s,r;let n=A[e.id];switch(console.log("Rendering question:",e.id,"type:",e.type,"value:",n),null===(t=e.type)||void 0===t?void 0:t.toLowerCase()){case"multiple_choice":case"multiplechoice":case"choice":case"select":case"radio":return(0,a.jsx)("div",{className:"space-y-2",children:null===(s=e.options)||void 0===s?void 0:s.map(t=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-option-").concat(t.id),name:"question-".concat(e.id),type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300",checked:n===t.id,onChange:()=>$(e.id,t.id)}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-option-").concat(t.id),className:"ml-3 text-sm text-gray-700",children:t.text})]},t.id))});case"checkboxes":case"checkbox":case"multiselect":case"multi":let o=Array.isArray(n)?n:[];return(0,a.jsx)("div",{className:"space-y-2",children:null===(r=e.options)||void 0===r?void 0:r.map(t=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-option-").concat(t.id),name:"question-".concat(e.id,"-option-").concat(t.id),type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:o.includes(t.id),onChange:()=>{let s=o.includes(t.id)?o.filter(e=>e!==t.id):[...o,t.id];$(e.id,s)}}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-option-").concat(t.id),className:"ml-3 text-sm text-gray-700",children:t.text})]},t.id))});case"text":case"textarea":case"string":case"freetext":case"free_text":return(0,a.jsx)("textarea",{id:"question-".concat(e.id),rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:n||"",onChange:t=>$(e.id,t.target.value)});case"number":case"numeric":case"integer":return(0,a.jsx)("input",{type:"number",id:"question-".concat(e.id),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:n||"",onChange:t=>$(e.id,t.target.value)});case"date":case"calendar":return(0,a.jsx)("input",{type:"date",id:"question-".concat(e.id),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:n||"",onChange:t=>$(e.id,t.target.value)});case"yes_no":case"yesno":case"boolean":case"yes/no":case"true/false":return(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-yes"),name:"question-".concat(e.id),type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300",checked:!0===n,onChange:()=>$(e.id,!0)}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-yes"),className:"ml-3 text-sm text-gray-700",children:"Yes"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-no"),name:"question-".concat(e.id),type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300",checked:!1===n,onChange:()=>$(e.id,!1)}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-no"),className:"ml-3 text-sm text-gray-700",children:"No"})]})]});case"bmi_calculator":case"bmi":let i=n||{height:"",weight:"",bmi:"",classification:""},l=(e,t)=>{if(e<=0||t<=0)return{bmi:"",classification:""};let s=t/(e*e)*703,a=Math.round(10*s)/10,r="";return r=s<18.5?"Underweight":s<25?"Normal weight":s<30?"Overweight":"Obese",{bmi:a.toString(),classification:r}},c=(t,s)=>{let a={...i,[t]:s};if(a.height&&a.weight){let e=parseFloat(a.height),t=parseFloat(a.weight);if(!isNaN(e)&&!isNaN(t)&&e>0&&t>0){let s=l(e,t);a.bmi=s.bmi,a.classification=s.classification}}$(e.id,a)};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"BMI Calculator"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"".concat(e.id,"-height"),className:"block text-sm font-medium text-gray-700 mb-1",children:"Height (inches)"}),(0,a.jsx)("input",{type:"number",id:"".concat(e.id,"-height"),value:i.height,onChange:e=>c("height",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter height in inches",min:"0",step:"0.1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"".concat(e.id,"-weight"),className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight (pounds)"}),(0,a.jsx)("input",{type:"number",id:"".concat(e.id,"-weight"),value:i.weight,onChange:e=>c("weight",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter weight in pounds",min:"0",step:"0.1"})]})]}),i.bmi&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-md",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"BMI Result:"}),(0,a.jsx)("p",{className:"text-xl font-bold text-blue-700",children:i.bmi})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Classification:"}),(0,a.jsx)("p",{className:"text-xl font-bold text-blue-700",children:i.classification})]})]})})]});case"vital_signs":case"vitalsigns":let d=n||{bloodPressureSystolic:"",bloodPressureDiastolic:"",heartRate:"",respiratoryRate:"",temperature:"",oxygenSaturation:"",height:"",weight:""},m=(t,s)=>{$(e.id,{...d,[t]:s})};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Vital Signs"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Blood Pressure (mmHg)"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"number",value:d.bloodPressureSystolic,onChange:e=>m("bloodPressureSystolic",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Systolic",min:"0"}),(0,a.jsx)("span",{className:"self-center",children:"/"}),(0,a.jsx)("input",{type:"number",value:d.bloodPressureDiastolic,onChange:e=>m("bloodPressureDiastolic",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Diastolic",min:"0"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heart Rate (bpm)"}),(0,a.jsx)("input",{type:"number",value:d.heartRate,onChange:e=>m("heartRate",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter heart rate",min:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Respiratory Rate (breaths/min)"}),(0,a.jsx)("input",{type:"number",value:d.respiratoryRate,onChange:e=>m("respiratoryRate",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter respiratory rate",min:"0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Temperature (\xb0F)"}),(0,a.jsx)("input",{type:"number",value:d.temperature,onChange:e=>m("temperature",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter temperature",min:"0",step:"0.1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Oxygen Saturation (%)"}),(0,a.jsx)("input",{type:"number",value:d.oxygenSaturation,onChange:e=>m("oxygenSaturation",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter oxygen saturation",min:"0",max:"100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height (inches)"}),(0,a.jsx)("input",{type:"number",value:d.height,onChange:e=>m("height",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter height",min:"0",step:"0.1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Weight (pounds)"}),(0,a.jsx)("input",{type:"number",value:d.weight,onChange:e=>m("weight",e.target.value),className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",placeholder:"Enter weight",min:"0",step:"0.1"})]})]})]});case"phq9":case"phq-9":let u=[{value:0,text:"Not at all"},{value:1,text:"Several days"},{value:2,text:"More than half the days"},{value:3,text:"Nearly every day"}],h=(null==n?void 0:n.answers)||Array(9).fill(0),x=h.reduce((e,t)=>e+(parseInt(t)||0),0),g="None";g=x>=20?"Severe depression":x>=15?"Moderately severe depression":x>=10?"Moderate depression":x>=5?"Mild depression":"Minimal or none";let b=(t,s)=>{let a=[...h];a[t]=s,$(e.id,{answers:a,total:a.reduce((e,t)=>e+(parseInt(t)||0),0)})};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"PHQ-9 Depression Screening"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Score"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-blue-700",children:[x,"/27"]}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:g})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Over the last 2 weeks, how often have you been bothered by any of the following problems?"}),(0,a.jsx)("div",{className:"space-y-4",children:["Little interest or pleasure in doing things","Feeling down, depressed, or hopeless","Trouble falling or staying asleep, or sleeping too much","Feeling tired or having little energy","Poor appetite or overeating","Feeling bad about yourself - or that you are a failure or have let yourself or your family down","Trouble concentrating on things, such as reading the newspaper or watching television","Moving or speaking so slowly that other people could have noticed. Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual","Thoughts that you would be better off dead, or of hurting yourself"].map((e,t)=>(0,a.jsxs)("div",{className:"border-b border-gray-200 pb-3",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-800 mb-2",children:[t+1,". ",e]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:u.map(e=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"phq9-q".concat(t,"-a").concat(e.value),type:"radio",name:"phq9-q".concat(t),value:e.value,checked:parseInt(h[t])===e.value,onChange:()=>b(t,e.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,a.jsx)("label",{htmlFor:"phq9-q".concat(t,"-a").concat(e.value),className:"ml-2 text-sm text-gray-700",children:e.text})]},e.value))})]},t))})]});case"phq2":case"phq-2":let p=[{value:0,text:"Not at all"},{value:1,text:"Several days"},{value:2,text:"More than half the days"},{value:3,text:"Nearly every day"}],f=(null==n?void 0:n.answers)||[0,0],v=f.reduce((e,t)=>e+(parseInt(t)||0),0),y=(t,s)=>{let a=[...f];a[t]=s,$(e.id,{answers:a,total:a.reduce((e,t)=>e+(parseInt(t)||0),0)})};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"PHQ-2 Depression Screening"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Score"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-blue-700",children:[v,"/6"]}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:v>=3?"Positive screen - further evaluation recommended":"Negative screen"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Over the last 2 weeks, how often have you been bothered by any of the following problems?"}),(0,a.jsx)("div",{className:"space-y-4",children:["Little interest or pleasure in doing things","Feeling down, depressed, or hopeless"].map((e,t)=>(0,a.jsxs)("div",{className:"border-b border-gray-200 pb-3",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-800 mb-2",children:[t+1,". ",e]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:p.map(e=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"phq2-q".concat(t,"-a").concat(e.value),type:"radio",name:"phq2-q".concat(t),value:e.value,checked:parseInt(f[t])===e.value,onChange:()=>y(t,e.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,a.jsx)("label",{htmlFor:"phq2-q".concat(t,"-a").concat(e.value),className:"ml-2 text-sm text-gray-700",children:e.text})]},e.value))})]},t))})]});case"mmse":case"mini-mental":let w=[{name:"Orientation to Time",maxPoints:5},{name:"Orientation to Place",maxPoints:5},{name:"Registration",maxPoints:3},{name:"Attention and Calculation",maxPoints:5},{name:"Recall",maxPoints:3},{name:"Language",maxPoints:8},{name:"Visual Construction",maxPoints:1}],j=(null==n?void 0:n.scores)||w.map(e=>0),N=j.reduce((e,t)=>e+(parseInt(t)||0),0),k="";k=N>=24?"Normal cognition":N>=19?"Mild cognitive impairment":N>=10?"Moderate cognitive impairment":"Severe cognitive impairment";let E=(t,s)=>{s=Math.min(s,w[t].maxPoints);let a=[...j];a[t]=s,$(e.id,{scores:a,total:a.reduce((e,t)=>e+(parseInt(t)||0),0)})};return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Mini-Mental State Examination (MMSE)"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Score"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-blue-700",children:[N,"/30"]}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:k})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:w.map((e,t)=>(0,a.jsxs)("div",{className:"border-b border-gray-200 pb-3",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Max: ",e.maxPoints," points"]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"number",min:"0",max:e.maxPoints,value:j[t]||0,onChange:e=>E(t,parseInt(e.target.value)||0),className:"w-20 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),(0,a.jsx)("div",{className:"ml-3 flex",children:[...Array(e.maxPoints)].map((e,s)=>(0,a.jsx)("button",{type:"button",onClick:()=>E(t,s+1),className:"h-8 w-8 rounded-full mx-1 focus:outline-none ".concat((j[t]||0)>s?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),children:s+1},s))})]})]},t))})]});case"scoring_scale":case"scoringscale":let S=e.options||[{id:"0",text:"0 - None",value:"0"},{id:"1",text:"1 - Mild",value:"1"},{id:"2",text:"2 - Moderate",value:"2"},{id:"3",text:"3 - Severe",value:"3"}];return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Scoring Scale"}),(0,a.jsx)("div",{className:"space-y-2",children:S.map(t=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-option-").concat(t.id),name:"question-".concat(e.id),type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300",checked:n===t.id,onChange:()=>$(e.id,t.id)}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-option-").concat(t.id),className:"ml-3 text-sm text-gray-700",children:t.text})]},t.id))})]});default:if(e.options&&e.options.length>0)return(0,a.jsx)("div",{className:"space-y-2",children:e.options.map(t=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"question-".concat(e.id,"-option-").concat(t.id),name:"question-".concat(e.id),type:"radio",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300",checked:n===t.id,onChange:()=>$(e.id,t.id)}),(0,a.jsx)("label",{htmlFor:"question-".concat(e.id,"-option-").concat(t.id),className:"ml-3 text-sm text-gray-700",children:t.text})]},t.id))});return console.warn("Unknown question type: ".concat(e.type," for question ID: ").concat(e.id),e),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-amber-600 mb-2",children:['Warning: Unrecognized question type "',e.type,'" - using text input as fallback']}),(0,a.jsx)("textarea",{id:"question-".concat(e.id),rows:3,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",value:n||"",onChange:t=>$(e.id,t.target.value)})]})}},ei=e=>{if(!e)return el();let t=[],s=new Set,a=e=>{let t=e.toLowerCase();return["recommend","should","advised","suggest","consider","try","increase","decrease","reduce","avoid","limit","follow up","schedule","consult","visit","appointment","check","monitor"].some(e=>t.includes(e))},r=e=>{let t=e.toLowerCase();return t.includes("exercise")||t.includes("physical activity")?"Exercise":t.includes("diet")||t.includes("nutrition")?"Nutrition":t.includes("follow up")||t.includes("appointment")?"Follow-up":t.includes("medication")?"Medication":"Lifestyle"};return Object.entries(e).forEach(e=>{let[n,o]=e;if(o){if(o.recommendations&&Array.isArray(o.recommendations)&&o.recommendations.forEach((e,a)=>{if(e&&e.text&&"string"==typeof e.text){let o=e.text.trim();o&&!s.has(o)&&(s.add(o),t.push({id:"template-".concat(n,"-").concat(a),text:o,category:e.category||r(o),source:"From template question: ".concat(n),selected:!0}))}}),o.selectedAnswers&&Array.isArray(o.selectedAnswers)&&o.selectedAnswers.forEach((e,a)=>{e&&e.recommendations&&Array.isArray(e.recommendations)&&e.recommendations.forEach((e,o)=>{if(e&&e.text&&"string"==typeof e.text){let i=e.text.trim();i&&!s.has(i)&&(s.add(i),t.push({id:"answer-".concat(n,"-").concat(a,"-").concat(o),text:i,category:e.category||r(i),source:"From selected answer in question: ".concat(n),selected:!0}))}})}),j&&j.sections){let e;for(let t of j.sections){if(!t.questions)continue;let s=t.questions.find(e=>e.id===n);if(s){e=s;break}}if(e&&e.options){if("string"==typeof o){let a=e.options.find(e=>e.id===o);a&&"recommendations"in a&&Array.isArray(a.recommendations)&&a.recommendations.forEach((e,i)=>{if(e&&e.text&&"string"==typeof e.text){let l=e.text.trim();l&&!s.has(l)&&(s.add(l),t.push({id:"option-".concat(n,"-").concat(o,"-").concat(i),text:l,category:e.category||r(l),source:"From selected option: ".concat(a.text),selected:!0}))}})}Array.isArray(o)&&o.forEach(a=>{var o;let i=null==e?void 0:null===(o=e.options)||void 0===o?void 0:o.find(e=>e.id===a);i&&"recommendations"in i&&Array.isArray(i.recommendations)&&i.recommendations.forEach((e,o)=>{if(e&&e.text&&"string"==typeof e.text){let l=e.text.trim();l&&!s.has(l)&&(s.add(l),t.push({id:"option-".concat(n,"-").concat(a,"-").concat(o),text:l,category:e.category||r(l),source:"From selected option: ".concat(i.text),selected:!0}))}})})}}if("object"==typeof o&&o.text&&"string"==typeof o.text&&a(o.text)){let e=o.text.trim();e&&!s.has(e)&&(s.add(e),t.push({id:"text-".concat(n),text:e,category:r(e),source:"From text response to question: ".concat(n),selected:!0}))}}}),console.log("Extracted ".concat(t.length," recommendations from responses")),t.length>0?t:el()},el=()=>[{id:"default-1",text:"Schedule a follow-up appointment with your primary care provider",category:"Follow-up",source:"Default recommendation",selected:!0},{id:"default-2",text:"Maintain a balanced diet rich in fruits, vegetables, and whole grains",category:"Nutrition",source:"Default recommendation",selected:!0},{id:"default-3",text:"Aim for at least 150 minutes of moderate physical activity each week",category:"Exercise",source:"Default recommendation",selected:!0}],ec=async()=>{try{X(!0);let e={};try{let{auth:t}=await Promise.resolve().then(s.bind(s,13843)),a=t.currentUser;if(a){let t=await a.getIdToken();e={Authorization:"Bearer ".concat(t)}}}catch(e){console.error("Error getting auth token:",e)}try{console.log("Attempting to fetch recommendations from API...");let t=await fetch("/api/visits/".concat(v,"/recommendations"),{headers:{...e}});if(!t.ok)throw Error("Error fetching recommendations: ".concat(t.status));let s=await t.json();console.log("Received ".concat(s.length," recommendations from API")),G(s)}catch(s){console.warn("API not available or error occurred, using local extraction:",s),console.log("Extracting recommendations from responses:",A);let e=ei(A);console.log("Extracted recommendations by category:");let t=e.reduce((e,t)=>{let s=t.category||"Uncategorized";return e[s]||(e[s]=[]),e[s].push(t),e},{});Object.entries(t).forEach(e=>{let[t,s]=e;console.log("".concat(t,": ").concat(s.length," recommendations")),s.forEach(e=>console.log("  - ".concat(e.text," (").concat(e.source,")")))}),G(e)}Y(!0)}catch(e){console.error("Error generating plan:",e),alert("Error generating plan. Please try again.")}finally{X(!1)}},ed=async()=>{if(v)try{X(!0);let e={},{auth:t}=await Promise.resolve().then(s.bind(s,13843)),a=t.currentUser;if(a){let t=await a.getIdToken();e={Authorization:"Bearer ".concat(t)}}let r={recommendations:J,createdAt:new Date().toISOString()};console.log("Generating health plan PDF...");let n=await fetch("/api/visits/pdf",{method:"POST",headers:{"Content-Type":"application/json",...e},body:JSON.stringify({visitId:v,planData:r,visitData:y,healthPlanOnly:!0})});if(!n.ok){let e=await n.text();throw console.error("PDF generation failed:",e),Error("Error generating PDF: ".concat(n.status,". ").concat(e))}let o=await n.blob(),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="Health_Plan_".concat(v,".pdf"),l.click(),URL.revokeObjectURL(i),console.log("Health plan saved as PDF successfully")}catch(e){console.error("Error saving health plan as PDF:",e),alert("Failed to save health plan as PDF: ".concat(e.message))}finally{X(!1)}};return k?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):!S&&y&&j?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)(i(),{href:"/dashboard-visits",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"Back to Visits"]}),(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Assessment: ",y.patientName]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Template: ",j.name," â€¢",W.length>0?" Section ".concat(q+1," of ").concat(W.length):" No sections"]})]}),(0,a.jsx)("div",{className:"mb-6 bg-gray-200 rounded-full h-2.5",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:"".concat(Z,"%")}})}),(0,a.jsxs)("div",{className:"bg-gray-50 shadow rounded-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:z.title||"Section"}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>en("in-progress"),disabled:I,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Save Progress"}),q===W.length-1&&(0,a.jsxs)("button",{type:"button",onClick:()=>en("completed"),disabled:I,className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Complete Assessment"]})]})]}),z.description&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-md",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(m,{className:"h-5 w-5 text-blue-400 mr-2"}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:z.description})]})}),(0,a.jsx)("div",{className:"space-y-6",children:z.questions&&z.questions.length>0?z.questions.map((e,t)=>et(e,t)):(0,a.jsx)("p",{className:"text-gray-500 italic text-center py-8",children:"No questions in this section"})}),(0,a.jsxs)("div",{className:"mt-8 pt-5 flex justify-between items-center border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{if(q>0){let e=q-1;for(;e>=0&&ea(e);)e--;e>=0?(C(e),window.scrollTo(0,0)):C(0)}},disabled:0===q,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous Section"}),q<W.length-1&&(0,a.jsxs)("button",{type:"button",onClick:er,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:["Next Section",(0,a.jsx)(u,{className:"ml-1 h-4 w-4"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-4",children:"Patient Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Name"}),(0,a.jsx)("p",{className:"text-md",children:y.patientName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Visit Date"}),(0,a.jsx)("p",{className:"text-md",children:new Date(y.date).toLocaleDateString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Provider"}),(0,a.jsx)("p",{className:"text-md",children:y.provider})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Duration"}),(0,a.jsxs)("p",{className:"text-md",children:[y.duration," minutes"]})]})]})]}),!Q&&q===W.length-1&&(0,a.jsx)("div",{className:"mt-6 flex justify-center",children:(0,a.jsx)("button",{onClick:ec,disabled:K,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:K?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating Plan..."]}):(0,a.jsx)(a.Fragment,{children:"Generate Personalized Health Plan"})})}),Q&&(0,a.jsxs)("div",{className:"mt-8 bg-white rounded-lg shadow-lg p-6 print:shadow-none",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6 print:hidden",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Personalized Health Plan"}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>{window.print()},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Print Plan"]}),(0,a.jsxs)("button",{onClick:ed,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Save Plan PDF"]}),(0,a.jsxs)("button",{onClick:()=>en("completed"),className:"inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Complete Visit"]}),(0,a.jsxs)("button",{onClick:()=>Y(!1),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Back"]})]})]}),(0,a.jsxs)("div",{className:"hidden print:block mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Personalized Health Plan"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["Generated on ",new Date().toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg overflow-hidden print:border print:border-gray-200",children:[(0,a.jsxs)("div",{className:"bg-blue-50 px-6 py-4 border-b border-blue-100 print:bg-white",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-blue-900",children:"Your Recommended Health Actions"}),(0,a.jsx)("p",{className:"text-blue-700 text-sm mt-1",children:"These recommendations are based on the information you provided during your visit."})]}),(0,a.jsx)("div",{className:"p-6",children:Object.entries(J.reduce((e,t)=>{let s=t.category||"Other";return e[s]||(e[s]=[]),e[s].push(t),e},{})).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"mb-6 last:mb-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 pb-2 border-b",children:t}),(0,a.jsx)("ul",{className:"space-y-3",children:s.map(e=>(0,a.jsx)("li",{className:"pl-5 text-gray-700",children:e.text},e.id))})]},t)})})]}),(0,a.jsxs)("div",{className:"mt-8 border-t pt-6 text-sm text-gray-500 hidden print:block",children:[(0,a.jsx)("p",{children:"This health plan was generated based on your Annual Wellness Visit assessment."}),(0,a.jsx)("p",{children:"Please follow up with your healthcare provider if you have any questions or concerns."})]})]})]}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 max-w-3xl mx-auto",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:S||"Unable to load the visit or template"}),(0,a.jsxs)(i(),{href:"/visits",className:"inline-flex items-center text-blue-600 hover:text-blue-800",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mr-1"}),"Back to Visits"]})]})})}new Date().toISOString()}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9192,6874,7131,9224,8441,1684,7358],()=>t(17896)),_N_E=e.O()}]);