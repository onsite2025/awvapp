(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4279],{9912:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(95155),c=a(11518),r=a.n(c),o=a(12115),n=a(35695),i=a(74065),l=a(86469),d=a(25052),m=a(85037),x=a(61316),u=a(31151),p=a(23464),h=a(26597),g=a(52699),b=a.n(g);function f(){var e;let t=(0,n.useParams)(),a=(0,n.useRouter)(),c=(0,i.d)(),g="string"==typeof(null==t?void 0:t.id)?t.id:"",[f,y]=(0,o.useState)(null),[j,v]=(0,o.useState)(null),[N,w]=(0,o.useState)(!0),[C,E]=(0,o.useState)(null),[k,F]=(0,o.useState)(!1),[A,S]=(0,o.useState)(null),[D,P]=(0,o.useState)(""),[R,L]=(0,o.useState)(""),[q,_]=(0,o.useState)(null),[M,O]=(0,o.useState)(!1),I=["Preventive Care","Lifestyle","Exercise","Nutrition","Follow-up","Medication","Mental Health","Specialist Referral","Screenings","Other"];(0,o.useEffect)(()=>{B()},[g]);let B=async()=>{if(g)try{w(!0),E(null);let e=(await p.A.get("/api/visits/".concat(g))).data;y(e),console.log("Visit data loaded:",e);try{let t=(await p.A.get("/api/plans?visitId=".concat(g))).data;t&&t.length>0?(v(t[0]),console.log("Plan data loaded:",t[0])):await H(e)}catch(t){if(t.response&&404===t.response.status)await H(e);else throw t}}catch(e){console.error("Failed to load data:",e),E("Failed to load data: ".concat(e.message||"Unknown error")),c.error("Error loading plan data")}finally{w(!1)}},H=async e=>{try{console.log("Creating new plan for visit:",e);let t=T(e.responses);console.log("Extracted recommendations:",t),e.responses&&e.responses.length>0&&(console.log("Response recommendation sources:"),e.responses.forEach((e,t)=>{var a,s,c,r;let o=e.question,n=e.answer;if(o&&"multiple_choice"===o.type&&n){let e=null===(a=o.options)||void 0===a?void 0:a.find(e=>e.text===n);console.log("Response ".concat(t+1,': Q="').concat(o.text,'" A="').concat(n,'"')),console.log("  - Has matching option: ".concat(!!e)),console.log("  - Option-specific recommendations: ".concat((null==e?void 0:null===(s=e.recommendations)||void 0===s?void 0:s.length)||0)),console.log("  - Default recommendations: ".concat((null===(c=o.defaultRecommendations)||void 0===c?void 0:c.length)||0))}else o&&(console.log("Response ".concat(t+1,': Q="').concat(o.text,'" A="').concat(n,'"')),console.log("  - Default recommendations: ".concat((null===(r=o.defaultRecommendations)||void 0===r?void 0:r.length)||0)))}));let a={visitId:g,recommendations:t,patientId:e.patientId,patientName:e.patientName,visitDate:e.date,templateId:e.templateId,providerId:e.providerId||"",providerName:e.providerName||""},s=await p.A.post("/api/plans",a);v(s.data),console.log("New plan created:",s.data),c.success("Health plan created successfully")}catch(e){var t;if(console.error("Error creating plan:",e),console.error("Error response:",null===(t=e.response)||void 0===t?void 0:t.data),e.response&&(console.error("Error status:",e.response.status),console.error("Error data:",e.response.data)),E("Error creating plan: ".concat(e.message||"Unknown error")),c.error("Failed to create health plan"),e.response&&400===e.response.status)try{console.log("Attempting fallback plan creation with minimal data");let e={visitId:g,recommendations:V()},t=await p.A.post("/api/plans",e);v(t.data),console.log("Fallback plan created:",t.data),c.success("Basic health plan created")}catch(e){console.error("Fallback plan creation failed:",e)}}},T=e=>{if(!e||!Array.isArray(e)||0===e.length)return V();let t=[];try{if(e.forEach(e=>{if(!e||!e.question)return;let a=e.question.text||"",s=e.answer;if(null!=s&&""!==s){if("multiple_choice"===e.question.type&&e.question.options&&Array.isArray(e.question.options)&&"string"==typeof s){let a=e.question.options.find(e=>e.text===s);a&&a.recommendations&&Array.isArray(a.recommendations)&&a.recommendations.length>0&&a.recommendations.forEach(e=>{e&&e.text&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:e.text,category:e.category||"Other",priority:"medium"})})}if(e.question.defaultRecommendations&&Array.isArray(e.question.defaultRecommendations)&&e.question.defaultRecommendations.length>0&&e.question.defaultRecommendations.forEach(e=>{e&&e.text&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:e.text,category:e.category||"Other",priority:"medium"})}),!t.some(t=>t.id.includes(e.question.id))&&("string"==typeof s&&s.toLowerCase().includes("yes")&&((a.toLowerCase().includes("smoke")||a.toLowerCase().includes("tobacco"))&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:"Consider smoking cessation program or counseling",category:"Lifestyle",priority:"high"}),a.toLowerCase().includes("alcohol")&&a.toLowerCase().includes("excess")&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:"Consider reducing alcohol consumption; aim for no more than 1-2 drinks per day",category:"Lifestyle",priority:"medium"}),a.toLowerCase().includes("exercise")&&a.toLowerCase().includes("regularly")&&s.toLowerCase().includes("no")&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:"Start with 150 minutes of moderate physical activity per week",category:"Exercise",priority:"medium"})),"number"==typeof s||"string"==typeof s&&!isNaN(Number(s)))){let e=Number(s);a.toLowerCase().includes("bmi")&&e>30&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:"Weight management program recommended; aim for 5-10% weight loss",category:"Nutrition",priority:"high"}),(a.toLowerCase().includes("blood pressure")||a.toLowerCase().includes("bp"))&&e>140&&t.push({id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:"Monitor blood pressure regularly; consider dietary modifications",category:"Follow-up",priority:"high"})}}}),0===t.length)return V();return t.filter((e,t,a)=>t===a.findIndex(t=>t.text===e.text))}catch(e){return console.error("Error extracting recommendations:",e),V()}},V=()=>[{id:"rec-".concat(Date.now(),"-1"),text:"Schedule annual physical exam",category:"Preventive Care",priority:"medium"},{id:"rec-".concat(Date.now(),"-2"),text:"Maintain regular exercise routine (150 minutes per week)",category:"Exercise",priority:"medium"},{id:"rec-".concat(Date.now(),"-3"),text:"Follow a balanced diet rich in fruits and vegetables",category:"Nutrition",priority:"medium"}],z=async()=>{if(j&&f)try{c.info("Preparing PDF document...");let e=document.getElementById("plan-content");if(!e)throw Error("Plan content not found");let t=await b()(e,{scale:2,logging:!1,useCORS:!0}),a=t.toDataURL("image/png"),s=new h.Ay({orientation:"portrait",unit:"mm",format:"a4"}),r=210*t.height/t.width;s.addImage(a,"PNG",0,0,210,r);let o="HealthPlan_".concat(f.patientName.replace(/\s+/g,"_"),"_").concat(new Date().toISOString().split("T")[0],".pdf");s.save(o),c.success("PDF downloaded successfully")}catch(e){console.error("Error creating PDF:",e),c.error("Failed to generate PDF")}},U=e=>{S(e.id),P(e.text),L(e.category)},Q=async e=>{if(j)try{let t=j.recommendations.map(t=>t.id===e?{...t,text:D,category:R,isEdited:!0}:t);v({...j,recommendations:t}),await p.A.put("/api/plans/".concat(j._id),{recommendations:t}),S(null),c.success("Recommendation updated")}catch(e){console.error("Error updating recommendation:",e),c.error("Failed to update recommendation")}},W=async e=>{if(j&&window.confirm("Are you sure you want to remove this recommendation?"))try{let t=j.recommendations.filter(t=>t.id!==e);v({...j,recommendations:t}),await p.A.put("/api/plans/".concat(j._id),{recommendations:t}),c.success("Recommendation removed")}catch(e){console.error("Error removing recommendation:",e),c.error("Failed to remove recommendation")}},G=async()=>{if(j&&q){if(!q.text.trim()){c.error("Recommendation text cannot be empty");return}try{let e={id:"rec-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),text:q.text.trim(),category:q.category,priority:"medium",isEdited:!0},t=[...j.recommendations,e];v({...j,recommendations:t}),await p.A.put("/api/plans/".concat(j._id),{recommendations:t}),_(null),c.success("Recommendation added")}catch(e){console.error("Error adding recommendation:",e),c.error("Failed to add recommendation")}}},J=()=>{S(null),_(null)},K=()=>(null==j?void 0:j.recommendations)&&0!==j.recommendations.length?j.recommendations.reduce((e,t)=>{let a=t.category||"Other";return e[a]||(e[a]=[]),e[a].push(t),e},{}):{},X=()=>{a.push("/visits/".concat(g))};return N?(0,s.jsxs)("div",{className:"min-h-screen flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,s.jsx)("p",{className:"ml-3 text-lg text-gray-600",children:"Loading health plan..."})]}):C?(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[(0,s.jsxs)("div",{className:"bg-red-50 text-red-800 p-4 rounded-lg mb-4 max-w-lg w-full",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Error Loading Plan"}),(0,s.jsx)("p",{children:C})]}),(0,s.jsx)("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Try Again"}),(0,s.jsx)("button",{onClick:X,className:"mt-3 px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50",children:"Back to Visit Details"})]}):f&&j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r(),{id:"97d305f2cac234c4",children:"@media print{body *{visibility:hidden}#plan-content,#plan-content *{visibility:visible}#plan-content{position:absolute;left:0;top:0;width:100%}.no-print{display:none!important}}"}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 "+"bg-gray-50 min-h-screen ".concat(k?"p-0":"p-4 md:p-8"),children:[(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 "+"mb-6 ".concat(k?"no-print":""),children:(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,s.jsx)("h1",{className:"jsx-97d305f2cac234c4 text-2xl font-bold text-gray-800 mb-4 md:mb-0",children:"Personalized Health Plan"}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 flex flex-wrap gap-3",children:[(0,s.jsx)("button",{onClick:X,className:"jsx-97d305f2cac234c4 px-3 py-1.5 border border-gray-300 rounded-md text-gray-600 hover:bg-gray-100 flex items-center text-sm",children:"Back to Visit"}),(0,s.jsxs)("button",{onClick:()=>{F(!0),setTimeout(()=>{window.print(),F(!1)},100)},className:"jsx-97d305f2cac234c4 px-3 py-1.5 border border-blue-500 bg-blue-50 rounded-md text-blue-700 hover:bg-blue-100 flex items-center text-sm",children:[(0,s.jsx)(l.A,{className:"h-4 w-4 mr-1"}),"Print"]}),(0,s.jsxs)("button",{onClick:z,className:"jsx-97d305f2cac234c4 px-3 py-1.5 border border-blue-500 bg-blue-50 rounded-md text-blue-700 hover:bg-blue-100 flex items-center text-sm",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Save PDF"]}),(0,s.jsxs)("button",{onClick:()=>{_({text:"",category:I[0]})},className:"jsx-97d305f2cac234c4 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center text-sm",children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"Add Recommendation"]})]})]})}),!1,(0,s.jsxs)("div",{id:"plan-content",className:"jsx-97d305f2cac234c4 "+"bg-white rounded-lg shadow-md ".concat(k?"":"p-6 md:p-8"),children:[(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 mb-8 text-center",children:[(0,s.jsx)("h2",{className:"jsx-97d305f2cac234c4 text-xl md:text-2xl font-bold text-blue-800 mb-1",children:"Personalized Health Plan"}),(0,s.jsxs)("p",{className:"jsx-97d305f2cac234c4 text-base text-gray-600",children:[f.patientName," - ",new Date(f.date).toLocaleDateString()]})]}),(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 mb-8",children:(0,s.jsx)("p",{className:"jsx-97d305f2cac234c4 text-gray-700 leading-relaxed",children:"This personalized health plan has been developed based on your Annual Wellness Visit. The recommendations below are designed to help you maintain and improve your health over the coming year. Please discuss any questions about these recommendations with your healthcare provider."})}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 mb-8",children:[(0,s.jsx)("h2",{className:"jsx-97d305f2cac234c4 text-xl font-semibold text-blue-900 mb-6 pb-2 border-b border-blue-200",children:"Health Recommendations"}),q&&(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,s.jsx)("h3",{className:"jsx-97d305f2cac234c4 text-lg font-medium mb-3",children:"Add New Recommendation"}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 space-y-3",children:[(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4",children:[(0,s.jsx)("label",{className:"jsx-97d305f2cac234c4 block text-sm font-medium text-gray-700 mb-1",children:"Recommendation Text"}),(0,s.jsx)("textarea",{value:q.text,onChange:e=>_({...q,text:e.target.value}),rows:3,className:"jsx-97d305f2cac234c4 w-full px-3 py-2 border border-gray-300 rounded-md"})]}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4",children:[(0,s.jsx)("label",{className:"jsx-97d305f2cac234c4 block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,s.jsx)("select",{value:q.category,onChange:e=>_({...q,category:e.target.value}),className:"jsx-97d305f2cac234c4 w-full px-3 py-2 border border-gray-300 rounded-md",children:I.map(e=>(0,s.jsx)("option",{value:e,className:"jsx-97d305f2cac234c4",children:e},e))})]}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 flex justify-end space-x-3 pt-2",children:[(0,s.jsx)("button",{onClick:J,className:"jsx-97d305f2cac234c4 px-3 py-1.5 border border-gray-300 rounded-md text-gray-600 hover:bg-gray-100",children:"Cancel"}),(0,s.jsx)("button",{onClick:G,className:"jsx-97d305f2cac234c4 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Recommendation"})]})]})]}),0===j.recommendations.length?(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 text-center py-8 border-2 border-dashed border-gray-200 rounded-lg",children:(0,s.jsx)("p",{className:"jsx-97d305f2cac234c4 text-gray-500",children:"No recommendations yet. Add some using the button above."})}):(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 recommendations-list",children:0===Object.entries(K()).length?(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 text-center py-8",children:(0,s.jsx)("p",{className:"jsx-97d305f2cac234c4 text-gray-500",children:"No recommendations available"})}):(0,s.jsxs)(s.Fragment,{children:[!k&&(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 recommendations-editable mb-8",children:Object.entries(K()).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 mb-6",children:[(0,s.jsx)("h3",{className:"jsx-97d305f2cac234c4 text-lg font-medium text-blue-800 mb-3 border-b border-blue-200 pb-1",children:t}),(0,s.jsx)("ul",{className:"jsx-97d305f2cac234c4 space-y-3",children:a.map(e=>(0,s.jsx)("li",{className:"jsx-97d305f2cac234c4 p-3 bg-gray-50 rounded-md relative group",children:A===e.id?(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 space-y-3",children:[(0,s.jsx)("textarea",{value:D,onChange:e=>P(e.target.value),rows:2,className:"jsx-97d305f2cac234c4 w-full px-3 py-2 border border-gray-300 rounded-md"}),(0,s.jsx)("select",{value:R,onChange:e=>L(e.target.value),className:"jsx-97d305f2cac234c4 w-full px-3 py-2 border border-gray-300 rounded-md",children:I.map(e=>(0,s.jsx)("option",{value:e,className:"jsx-97d305f2cac234c4",children:e},e))}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:J,className:"jsx-97d305f2cac234c4 px-2 py-1 text-sm border border-gray-300 rounded-md text-gray-600 hover:bg-gray-100",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>Q(e.id),className:"jsx-97d305f2cac234c4 px-2 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 pr-20 text-gray-700",children:e.text}),(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 absolute top-3 right-3 flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,s.jsx)("button",{onClick:()=>U(e),title:"Edit recommendation",className:"jsx-97d305f2cac234c4 text-blue-600 hover:text-blue-800",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})}),(0,s.jsx)("button",{onClick:()=>W(e.id),title:"Delete recommendation",className:"jsx-97d305f2cac234c4 text-red-600 hover:text-red-800",children:(0,s.jsx)(u.A,{className:"h-4 w-4"})})]})]})},e.id))})]},t)})}),k&&(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 recommendations-print",children:Object.keys(e=K()).sort((e,t)=>"Preventive Care"===e?-1:"Preventive Care"===t?1:"Follow-up"===e?-1:"Follow-up"===t?1:e.localeCompare(t)).map(t=>(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-blue-800 mb-2 border-b border-blue-200 pb-1",children:t}),(0,s.jsx)("ul",{className:"space-y-2",children:e[t].map(e=>(0,s.jsxs)("li",{className:"ml-5 relative",children:[(0,s.jsx)("span",{className:"absolute -left-5 top-1.5 h-2 w-2 bg-blue-600 rounded-full"}),(0,s.jsx)("div",{className:"text-gray-700",children:e.text})]},e.id))})]},t))})]})})]}),(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 mt-12 pt-6 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"jsx-97d305f2cac234c4 text-center text-sm text-gray-600",children:[(0,s.jsx)("p",{className:"jsx-97d305f2cac234c4 mb-6",children:"Please contact our office if you have any questions about these recommendations."}),(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 mt-10 pt-8 flex items-end justify-center",children:(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 border-t border-gray-400 w-64",children:(0,s.jsx)("p",{className:"jsx-97d305f2cac234c4 pt-1",children:"Healthcare Provider Signature / Date"})})})]})})]}),!k&&(0,s.jsx)("div",{className:"jsx-97d305f2cac234c4 mt-8 text-center no-print",children:(0,s.jsx)("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"jsx-97d305f2cac234c4 px-4 py-2 text-blue-600 border border-blue-300 rounded-full text-sm hover:bg-blue-50",children:"Back to top"})})]})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"No plan data available. Please try again."})})}},30373:(e,t,a)=>{Promise.resolve().then(a.bind(a,9912))},74065:(e,t,a)=>{"use strict";a.d(t,{d:()=>c});var s=a(13568);let c=()=>({success:e=>s.oR.success(e),error:e=>s.oR.error(e),warning:e=>(0,s.oR)(e,{icon:"⚠️",style:{backgroundColor:"#FFFBEB",color:"#92400E",border:"1px solid #FEF3C7"}}),info:e=>(0,s.oR)(e,{icon:"ℹ️",style:{backgroundColor:"#EFF6FF",color:"#1E40AF",border:"1px solid #DBEAFE"}})})}},e=>{var t=t=>e(e.s=t);e.O(0,[3930,4316,7131,7356,3401,8441,1684,7358],()=>t(30373)),_N_E=e.O()}]);